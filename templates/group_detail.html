{% extends "base.html" %}

{% block title %}Group {{ group_id }} - Telegram Bot{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('groups') }}">Groups</a></li>
                <li class="breadcrumb-item active">Group {{ group_id }}</li>
            </ol>
        </nav>
        <h1 class="h3 mb-3">
            <i class="fas fa-users me-2"></i>
            {{ group_data.get('name', 'Group ' + group_id) }}
        </h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-cog me-2"></i>Settings
                </h5>
            </div>
            <div class="card-body">
                <form id="settingsForm">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="antiSpam" 
                               {% if group_data.get('settings', {}).get('anti_spam_enabled', True) %}checked{% endif %}>
                        <label class="form-check-label" for="antiSpam">
                            Anti-Spam Protection
                        </label>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="captcha" 
                               {% if group_data.get('settings', {}).get('captcha_enabled', False) %}checked{% endif %}>
                        <label class="form-check-label" for="captcha">
                            Captcha for New Members
                        </label>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="welcome" 
                               {% if group_data.get('settings', {}).get('welcome_enabled', True) %}checked{% endif %}>
                        <label class="form-check-label" for="welcome">
                            Welcome Messages
                        </label>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="flood" 
                               {% if group_data.get('settings', {}).get('flood_protection', True) %}checked{% endif %}>
                        <label class="form-check-label" for="flood">
                            Flood Protection
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Save Settings
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>Group Information
                </h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Group ID:</dt>
                    <dd class="col-sm-8"><code>{{ group_id }}</code></dd>
                    
                    <dt class="col-sm-4">Log Channel:</dt>
                    <dd class="col-sm-8">
                        {% if group_data.get('log_channel') %}
                            <span class="badge bg-info">@{{ group_data.log_channel }}</span>
                        {% else %}
                            <span class="text-muted">Not configured</span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-4">Banned Words:</dt>
                    <dd class="col-sm-8">
                        <span class="badge bg-warning">{{ group_data.get('banned_words', [])|length }}</span>
                    </dd>
                    
                    <dt class="col-sm-4">Welcome Message:</dt>
                    <dd class="col-sm-8">
                        {% if group_data.get('welcome_message') %}
                            <small class="text-muted">Custom message set</small>
                        {% else %}
                            <small class="text-muted">Using default</small>
                        {% endif %}
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-ban me-2"></i>Banned Words
                </h5>
            </div>
            <div class="card-body">
                {% if group_data.get('banned_words') %}
                <div class="row">
                    {% for word in group_data.banned_words %}
                    <div class="col-md-4 mb-2">
                        <span class="badge bg-danger">{{ word }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="fas fa-ban fa-2x text-muted mb-2"></i>
                    <p class="text-muted">No banned words configured</p>
                    <small class="text-muted">Use /addword command in the group to add banned words</small>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('settingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const settings = {
        anti_spam_enabled: document.getElementById('antiSpam').checked,
        captcha_enabled: document.getElementById('captcha').checked,
        welcome_enabled: document.getElementById('welcome').checked,
        flood_protection: document.getElementById('flood').checked
    };
    
    fetch(`/api/group/{{ group_id }}/settings`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({settings: settings})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Settings saved successfully!');
        } else {
            alert('Error saving settings: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving settings');
    });
});
</script>
{% endblock %}